sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","it/horsa/gualapack/macchina/model/formatter","sap/ui/model/json/JSONModel","sap/m/Button","sap/m/Dialog","sap/m/List","sap/m/StandardListItem","sap/ui/layout/Grid","sap/m/FlexBox","./SqlFieldType","./MesServices"],function(e,t,o,i,n,a,s,r,l,u,d,c,m){"use strict";return e.extend("it.horsa.gualapack.macchina.controller.BaseController",{estrusione:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("estrusione")},onAfterRendering:function(){m("orders").then(e=>this.ordini(e),e=>console.log(`%cBaseController `,`border:1px solid gold;color:gold;padding:2px 4px;`,`err`,e));m("stampa").then(e=>this.cdl(e));let e=document.location.hash.split("/").pop();e=e||"stampa";this.gauge_init()},ordini:function(e){console.log(`%cBaseController ordini`,`border:1px solid black;color:black;padding:2px 4px;`,`orders_data`,e);const t=[];const o=new sap.ui.model.json.JSONModel;o.setData(e);this.getView().setModel(o,"ordini");var i=this.getView().byId("tabella");e.Rowsets.Rowset[0].Columns.Column.forEach((e,o)=>{i.addColumn(new sap.m.Column({header:new sap.m.Label({text:e.Name}),hAlign:e.SQLDataType>=3&&e.SQLDataType<10?"Right":"Left"}));t.push(c(e))});i.setModel(o);i.bindItems("/Rowsets/Rowset/0/Row",new sap.m.ColumnListItem({cells:t}));i.setFixedLayout(false);i.setAlternateRowColors(true)},cdl:function(e){const t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"scheda");const o=this.getView().getModel("i18n");document.title=o.getResourceBundle().getText("title")+" > "+e.nome;var i=this.getView().byId("microchart");i.setModel(t)},gauge_init:function(){var e=0;var t=380;var o={min:0,max:380,error_min:0,error_max:90};var i=new RadialGauge({renderTo:"canvas-id",width:222,height:222,units:"",minValue:o.min,startAngle:180,ticksAngle:180,valueBox:false,maxValue:o.max,value:0,majorTicks:["0","76","152","228","304","380"],minorTicks:2,strokeTicks:true,highlights:[{from:o.error_min,to:o.error_max,color:"#C00"},{from:90,to:152,color:"rgba(255, 255, 0, .75)"},{from:152,to:380,color:"#3fa45b"}],colorPlate:"rgba(240, 240, 240, 1)",borderShadowWidth:0,borders:false,needleType:"arrow",needleStart:1,needleWidth:3,needleCircleSize:7,needleCircleOuter:true,needleCircleInner:false,animationDuration:1e3,animationRule:"dequad"}).draw();this.gauge_update(i,o);setInterval(()=>{this.gauge_update(i,o)},1e4)},gauge_update:function(e,t){e.value=this.random_number(20,180);var o=document.querySelector(".status-tile");o.classList.remove("status-tile--error");o.classList.remove("status-tile--success");var i=e.value>=t.error_min&&e.value<=t.error_max;o.classList.add(i?"status-tile--error":"status-tile--success");var n="sap-icon://message-success";if(i){document.querySelector(".status-tile__label--error").style.display="block";document.querySelector(".status-tile__label--success").style.display="none";n="sap-icon://message-warning"}else{document.querySelector(".status-tile__label--error").style.display="none";document.querySelector(".status-tile__label--success").style.display="block"}},random_number:function(e,t){e=Math.ceil(e);t=Math.floor(t);return Math.floor(Math.random()*(t-e+1))+e},formatter:i,getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},navTo:function(e,t,o){this.getRouter().navTo(e,t,o)},getRouter:function(){return o.getRouterFor(this)},onNavBack:function(){var e=t.getInstance().getPreviousHash();if(e!==undefined){window.history.back()}else{this.getRouter().navTo("appHome",{},true)}},menuTTS:function(){if(!this.oFixedSizeDialog){const e=e=>new a({text:"{scheda>text}",type:e||"Default",width:"100%"});const t=new sap.ui.layout.FixFlex({fixContent:[new sap.m.Title({text:"Ordini",level:"H1"}).addStyleClass("grid_title"),new u({defaultSpan:"XL6 L6 M12 S12",content:{path:"scheda>/ordini",template:e()}})]}).addStyleClass("ordini_bg");const o=new sap.ui.layout.FixFlex({fixContent:[new sap.m.Title({text:"Funzioni",level:"H1"}).addStyleClass("grid_title"),new u({defaultSpan:"XL4 L4 M6 S12",content:{path:"scheda>/funzioni",template:e()}})]}).addStyleClass("funzioni_bg");const i=[t,o];const n=new d({items:i});this.oFixedSizeDialog=new s({title:"Funzioni ordine attivo",content:n,endButton:new a({text:"Chiudi",press:function(){this.oFixedSizeDialog.close()}.bind(this)})});this.getView().addDependent(this.oFixedSizeDialog)}this.oFixedSizeDialog.open()}})});